<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect with Payload</title>
</head>
<body>

<script>
function redirectWithPayloadFromURL() {
    // Get the current URL
    var currentURL = window.location.href;

    // Find the position of the '?' character
    var questionMarkIndex = currentURL.indexOf('?');

    // If there are no query parameters, return
    if (questionMarkIndex === -1) {
        console.error("No query parameters found in the URL.");
        return;
    }

    // Extract the query string after the '?' character
    var queryString = currentURL.substring(questionMarkIndex + 1);

    // Split the query string into key-value pairs
    var paramsArray = queryString.split('&');

    // Create an object to hold the parameters
    var payload = {};

    // Iterate over the key-value pairs and populate the payload object
    paramsArray.forEach(function(param) {
        var keyValue = param.split('=');
        var key = decodeURIComponent(keyValue[0]);
        var value = decodeURIComponent(keyValue[1]);
        payload[key] = value;
    });

    // Convert the payload to a JSON string
    var payloadString = JSON.stringify(payload);

    // Send the payload via POST request
    fetch('localhost:7350/auth_user', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: payloadString
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to send payload.');
        }
        return response.json();
    })
    .then(data => {
        console.log('Payload sent successfully:', data);
        // Optionally redirect the user after successful POST request
        //window.location.href = "https://example.com/redirect-success";
    })
    .catch(error => {
        console.error('Error sending payload:', error.message);
        // Optionally redirect the user after failed POST request
        //window.location.href = "https://example.com/redirect-error";
    });

    // Display the payload on the page
    var payloadDisplay = document.createElement('p');
    payloadDisplay.textContent = "Extracted Payload: " + payloadString;
    document.body.appendChild(payloadDisplay);
}

// Call the function when the page loads
window.onload = redirectWithPayloadFromURL;
</script>

</body>
</html>

